generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String         @id @default(cuid())
  email         String?        @unique
  phone         String?        @unique
  password      String
  firstName     String?
  lastName      String?
  avatar        String?
  role          UserRole       @default(DONOR)
  isVerified    Boolean        @default(false)
  isActive      Boolean        @default(true)
  lastLoginAt   DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  donations     Donation[]
  orders        Order[]
  refreshTokens RefreshToken[]
  transactions  Transaction[]

  @@index([email])
  @@index([phone])
  @@index([role])
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

model Project {
  id              String               @id @default(cuid())
  slug            String               @unique
  status          ProjectStatus        @default(DRAFT)
  goalAmount      Decimal              @db.Decimal(12, 2)
  collectedAmount Decimal              @default(0) @db.Decimal(12, 2)
  donorCount      Int                  @default(0)
  featuredImage   String?
  gallery         String[]
  isUrgent        Boolean              @default(false)
  isFeatured      Boolean              @default(false)
  startDate       DateTime?
  endDate         DateTime?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  campaigns       CampaignProject[]
  donations       Donation[]
  translations    ProjectTranslation[]

  @@index([slug])
  @@index([status])
  @@index([isUrgent])
  @@index([isFeatured])
}

model ProjectTranslation {
  id          String   @id @default(cuid())
  projectId   String
  language    Language
  title       String
  description String
  shortDesc   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, language])
  @@index([projectId])
  @@index([language])
}

model Campaign {
  id              String                @id @default(cuid())
  slug            String                @unique
  status          CampaignStatus        @default(DRAFT)
  goalAmount      Decimal?              @db.Decimal(12, 2)
  collectedAmount Decimal               @default(0) @db.Decimal(12, 2)
  featuredImage   String?
  startDate       DateTime
  endDate         DateTime
  isUrgent        Boolean               @default(false)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  projects        CampaignProject[]
  translations    CampaignTranslation[]
  donations       Donation[]

  @@index([slug])
  @@index([status])
  @@index([startDate, endDate])
}

model CampaignTranslation {
  id          String   @id @default(cuid())
  campaignId  String
  language    Language
  title       String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, language])
  @@index([campaignId])
  @@index([language])
}

model CampaignProject {
  id         String   @id @default(cuid())
  campaignId String
  projectId  String
  createdAt  DateTime @default(now())
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([campaignId, projectId])
  @@index([campaignId])
  @@index([projectId])
}

model Donation {
  id           String        @id @default(cuid())
  amount       Decimal       @db.Decimal(12, 2)
  currency     String        @default("XOF")
  type         DonationType  @default(ONE_TIME)
  isAnonymous  Boolean       @default(false)
  message      String?
  donorName    String?
  donorEmail   String?
  donorPhone   String?
  userId       String?
  projectId    String?
  campaignId   String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  campaign     Campaign?     @relation(fields: [campaignId], references: [id])
  project      Project?      @relation(fields: [projectId], references: [id])
  user         User?         @relation(fields: [userId], references: [id])
  receipt      Receipt?
  subscription Subscription?
  transaction  Transaction?

  @@index([userId])
  @@index([projectId])
  @@index([campaignId])
  @@index([createdAt])
  @@index([type])
}

model Transaction {
  id            String            @id @default(cuid())
  externalId    String?           @unique
  amount        Decimal           @db.Decimal(12, 2)
  currency      String            @default("XOF")
  paymentMethod PaymentMethod
  status        TransactionStatus @default(PENDING)
  providerRef   String?
  errorMessage  String?
  metadata      Json?
  donationId    String            @unique
  userId        String?
  paidAt        DateTime?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  donation      Donation          @relation(fields: [donationId], references: [id], onDelete: Cascade)
  user          User?             @relation(fields: [userId], references: [id])

  @@index([externalId])
  @@index([status])
  @@index([paymentMethod])
  @@index([createdAt])
  @@index([userId])
}

model Subscription {
  id              String        @id @default(cuid())
  amount          Decimal       @db.Decimal(12, 2)
  currency        String        @default("XOF")
  paymentMethod   PaymentMethod
  isActive        Boolean       @default(true)
  nextPaymentDate DateTime?
  lastPaymentDate DateTime?
  donationId      String        @unique
  cancelledAt     DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  donation        Donation      @relation(fields: [donationId], references: [id], onDelete: Cascade)

  @@index([isActive])
  @@index([nextPaymentDate])
}

model Receipt {
  id         String   @id @default(cuid())
  receiptNo  String   @unique
  donationId String   @unique
  pdfUrl     String?
  issuedAt   DateTime @default(now())
  createdAt  DateTime @default(now())
  donation   Donation @relation(fields: [donationId], references: [id], onDelete: Cascade)

  @@index([receiptNo])
}

model Product {
  id           String               @id @default(cuid())
  slug         String               @unique
  price        Decimal              @db.Decimal(10, 2)
  comparePrice Decimal?             @db.Decimal(10, 2)
  stock        Int                  @default(0)
  images       String[]
  isActive     Boolean              @default(true)
  isFeatured   Boolean              @default(false)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  orderItems   OrderItem[]
  categories   ProductCategory[]
  translations ProductTranslation[]

  @@index([slug])
  @@index([isActive])
  @@index([isFeatured])
}

model ProductTranslation {
  id          String   @id @default(cuid())
  productId   String
  language    Language
  name        String
  description String?
  metaTitle   String?
  metaDesc    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, language])
  @@index([productId])
  @@index([language])
}

model Category {
  id           String                @id @default(cuid())
  slug         String                @unique
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  translations CategoryTranslation[]
  products     ProductCategory[]

  @@index([slug])
}

model CategoryTranslation {
  id         String   @id @default(cuid())
  categoryId String
  language   Language
  name       String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, language])
  @@index([categoryId])
  @@index([language])
}

model ProductCategory {
  id         String   @id @default(cuid())
  productId  String
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, categoryId])
  @@index([productId])
  @@index([categoryId])
}

model Order {
  id              String      @id @default(cuid())
  orderNumber     String      @unique
  status          OrderStatus @default(PENDING)
  subtotal        Decimal     @db.Decimal(12, 2)
  shippingCost    Decimal     @default(0) @db.Decimal(10, 2)
  total           Decimal     @db.Decimal(12, 2)
  currency        String      @default("XOF")
  customerName    String
  customerEmail   String
  customerPhone   String?
  shippingAddress String?
  userId          String?
  paidAt          DateTime?
  shippedAt       DateTime?
  deliveredAt     DateTime?
  cancelledAt     DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  user            User?       @relation(fields: [userId], references: [id])
  items           OrderItem[]

  @@index([orderNumber])
  @@index([status])
  @@index([userId])
  @@index([createdAt])
}

model OrderItem {
  id        String  @id @default(cuid())
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  orderId   String
  productId String
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

model Content {
  id            String               @id @default(cuid())
  slug          String               @unique
  type          ContentType
  featuredImage String?
  publishedAt   DateTime?
  isPublished   Boolean              @default(false)
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  translations  ContentTranslation[]

  @@index([slug])
  @@index([type])
  @@index([isPublished])
  @@index([publishedAt])
}

model ContentTranslation {
  id        String   @id @default(cuid())
  contentId String
  language  Language
  title     String
  body      String
  excerpt   String?
  metaTitle String?
  metaDesc  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  content   Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([contentId, language])
  @@index([contentId])
  @@index([language])
}

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
}

model Media {
  id           String   @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  url          String
  alt          String?
  createdAt    DateTime @default(now())

  @@index([filename])
  @@index([mimeType])
}

model Contact {
  id        String    @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String?
  message   String
  isRead    Boolean   @default(false)
  repliedAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([isRead])
  @@index([createdAt])
}

model Newsletter {
  id           String   @id @default(cuid())
  email        String   @unique
  isSubscribed Boolean  @default(true)
  subscribedAt DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([email])
  @@index([isSubscribed])
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  entityId  String
  userId    String?
  userEmail String?
  ipAddress String?
  userAgent String?
  oldData   Json?
  newData   Json?
  createdAt DateTime @default(now())

  @@index([entity, entityId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

enum UserRole {
  ADMIN
  MANAGER
  USER
  DONOR
}

enum DonationType {
  ONE_TIME
  MONTHLY
}

enum PaymentMethod {
  WAVE
  ORANGE_MONEY
  FREE_MONEY
  VISA
  MASTERCARD
  BANK_TRANSFER
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
  CANCELLED
}

enum ProjectStatus {
  DRAFT
  ACTIVE
  COMPLETED
  SUSPENDED
  ARCHIVED
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  COMPLETED
  CANCELLED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum ContentType {
  ARTICLE
  PAGE
  EVENT
  TESTIMONIAL
  FAQ
}

enum Language {
  FR
  EN
  AR
}
